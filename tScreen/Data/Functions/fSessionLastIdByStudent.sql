SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF OBJECT_ID('dbo.fSessionLastIdByStudent') IS NOT NULL
BEGIN
    DROP FUNCTION dbo.fSessionLastIdByStudent
END
GO

CREATE FUNCTION dbo.fSessionLastIdByStudent(
    @studentId UNIQUEIDENTIFIER
)
    RETURNS UNIQUEIDENTIFIER AS
BEGIN
    DECLARE @Id UNIQUEIDENTIFIER;
    SELECT TOP 1 @id = Id FROM TweenScreenApp.Session WHERE StudentId = @studentId ORDER BY CreatedAt DESC;
    return @id;
END;